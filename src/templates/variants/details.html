<!-- templates/variants/details.html -->
{% extends 'base.html' %}

{% block title %}Details{% endblock %}

{% block content %}
{% if request.user.id == query.user_id %}
<div class='row my-3'>
    <div class="card border-info" style="width:60rem;">
        <div class="card-header border-bottom border-info">
            <div class="row col-md-12">
                <div class="col-md-4 text-left">
                    <h6>{{ query.label }}</h6>
                    <h6>{{ query.query }}</h6>
                </div>
                <div class="col-md-4 text-center">
                    <h6>Created</h6>
                    <h6>{{ query.date }}</h6>
                </div>
                <div class="col-md-4 text-right">
                    <h6>Changed</h6>
                    <h6>{{ query.update }}</h6>
                </div>
            </div>
        </div>
        <div class="card-body">
            <table class="table text-center border border-primary">
                <tr class="table-primary">
                    <th class="border-bottom border-primary">Assembly</th>
                    <th class="border-bottom border-primary">Chromosome</th>
                    <th class="border-bottom border-primary">Position</th>
                    <th class="border-bottom border-primary">Reference</th>
                    <th class="border-bottom border-primary">Alternate</th>
                </tr>
                <tr class="table-light">
                    <td>{{ query.assembly }}</td>
                    <td>{{ query.chromosome }}</td>
                    <td>{{ query.position }}</td>
                    <td>{{ query.variant_ref }}</td>
                    <td>{{ query.variant_alt }}</td>
                </tr>
            </table>
            <div class="card-text border border-primary">
                <ul class="nav nav-tabs bg-light border-bottom border-primary">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#new">Current</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#old">Previous</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#diff">Difference</a>
                    </li>
                </ul>
                <div id="myTabContent" class="tab-content">
                    <div class="tab-pane fade bg-white" id="old">
                       {% if query.previous %}
                        <div class="row col--12 table-primary my-2 mx-2" style="height:3em">
                            <div class="col-1 my-auto">&nbsp;</div>
                            <div class="col-5 my-auto"><strong>Field</strong></div>
                            <div class="col-3 my-auto"><strong>Value</strong></div>
                        </div>
                       {% for k,v in query.previous.items %}
                        <div class="row col--12 my-2 mx-2 {% if forloop.counter|divisibleby:'2' %}bg-light{% endif %}"
                            style="{% if forloop.counter|divisibleby:'2' %} height:3em {% else %} height:2em {% endif %}" >
                            <div class="col-1 my-auto">{{ forloop.counter }}</div>
                            <div class="col-5 my-auto">{{ k }}</div>
                            <div class="col-3 my-auto">{{ v }}</div>
                        </div>
                           {% endfor %}
                        {% else %}
                       <div class="alert alert-dismissible alert-secondary mx-2 my-2">
                            <h1><strong>Query did not return result</strong></h1>
                        </div>
                        {% endif %}
                       </div>
                    <div class="tab-pane fade show active bg-white" id="new">
                        {% if query.result %}
                    <div class="row col--12 table-primary my-2 mx-2" style="height:3em">
                            <div class="col-1 my-auto">&nbsp;</div>
                            <div class="col-5 my-auto"><strong>Field</strong></div>
                            <div class="col-3 my-auto"><strong>Value</strong></div>
                        </div>
                       {% for k,v in query.result.items %}
                        <div class="row col--12 my-2 mx-2 {% if forloop.counter|divisibleby:'2' %} bg-light {% endif %}"
                             style="{% if forloop.counter|divisibleby:'2' %} height:3em {% else %} height:2em {% endif %}" >
                            <div class="col-1 my-auto">{{ forloop.counter }}</div>
                            <div class="col-5 my-auto">{{ k }}</div>
                            <div class="col-3 my-auto">{{ v }}</div>
                        </div>
                           {% endfor %}
                       {% else %}
                       <div class="alert alert-dismissible alert-secondary mx-2 my-2">
                            <h1><strong>Query did not return result</strong></h1>
                        </div>
                        {% endif %}
                    </div>
                    <div class="tab-pane fade" id="diff">
                        {% if query.difference %}
                       <div class="row col--12 table-primary my-2 mx-2" style="height:3em">
                            <div class="col-1 my-auto">&nbsp;</div>
                            <div class="col-5 my-auto"><strong>Field</strong></div>
                            <div class="col-2 my-auto"><strong>Type</strong></div>
                            <div class="col-2 my-auto"><strong>Previous</strong></div>
                            <div class="col-2 my-auto"><strong>Current</strong></div>
                        </div>
                       {% for d in query.difference %}
                        <div class="row col--12 my-2 mx-2 {% if forloop.counter|divisibleby:'2' %}bg-light{% endif %}"
                            style="{% if forloop.counter|divisibleby:'2' %} height:3em {% else %} height:2em {% endif %}" >
                            <div class="col-1 my-auto">{{ forloop.counter }}</div>
                            <div class="col-5 my-auto">{{ d.field }}</div>
                            <div class="col-2 my-auto">{{ d.type }}</div>
                            <div class="col-2 my-auto">{{ d.previous }}</div>
                            <div class="col-2 my-auto">{{ d.current }}</div>
                        </div>
                           {% endfor %}
                        {% else %}
                        <div class="alert alert-dismissible alert-secondary mx-2 my-2">
                            <h1><strong>Nothing is changed</strong></h1>
                        </div>
                        {% endif %}
                       </div>
                    </div>
                </div>
            </div>
            <div class="text-right my-2 mr-2">
                <button class="btn btn-sm btn-outline-success" onclick="rerun('{{ query.id }}');">ReRun</button>
            </div>
        </div>
</div>
{% else %}
<div class="alert alert-dismissible alert-danger mt-4" style="width:100rem">
    <h1 class="alert-heading">404</h1>
    <p class="mb-2">
    <h2>OPS! Page not found!</h2></p>
    <h3>The page you are looking for doesn't exist:
        <a href="{% url 'home' %}">Come back home!</a>
    </h3>
</div>{% endif %}
<div class="modal fade" tabindex="-1" role="dialog" id="spinnerModal">
    <div class="modal-dialog modal-dialog-centered text-center" role="document">
        <div class="modal-body">
            <h1 class="text-white">Wait while loading...</h1>
            <div class="spinner-border text-info"
                 style="width: 5rem; height: 5rem;"
                 role="status">
                <span class="sr-only">Loading...</span>
            </div>
            <h3 class="text-white">It may take a long time</h3>
        </div>
    </div>
</div>

{% endblock %}
